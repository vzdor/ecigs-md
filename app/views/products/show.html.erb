<% title(h(@product.title), false) %>

<div id="product-page">
  <div class="photo"><%= link_to image_tag(@product.photo.url(:thumb)), @product.photo.url(:large), :rel => 'lightbox[photos]' %></div>
  <h2><%= yield(:title) %></h2>
  <%= form_for @cart, :url => cart_path, :html => {:method => :put} do |f| %>
  <ul>
    <% if is_admin? %>
      <li><%= link_to "Edit", edit_product_path(@product) %></li>
    <% end %>
    <li><%= t(:similar_products) %>: <%= tags_links(@product) %></li>
    <% unless @product.is_variable_price? %>
      <li class="price"><%= t(:price) %>: <%= product_price(@product) %></li>
    <% end %>
    <% unless @product.has_variations? %>
      <% if @product.in_stock? %>
        <li><%= t(:available) %>: <%= @product.quantity %></li>
        <li>
          <%= f.fields_for :order_lines, OrderLine.new do |ff| %>
            <%= ff.hidden_field :product_id, :value => @product.id %>
            <%= t(:quantity) %>: <%= ff.text_field :quantity, :size => 4, :value => 1 %>
            <%= submit_tag t(:add_to_cart), :class => "button cart-add" %>
          <% end %>
        </li>
      <% else %>
        <%= t(:out_of_stock) %>. <%= t(:let_us_know_if_you_want_the_product) %>.
      <% end %>
    <% end %>
  </ul>
  <div class="cut"></div>

  <% if @product.assets.present? %>
    <div class="assets">
      <% @product.assets.each do |asset| %>
        <div class="photo"><%= link_to image_tag(asset.blob.url(:thumb)), asset.blob.url(:large), :rel => "lightbox[photos]" %></div>
      <% end %>
    </div>
  <% end %>
  <div class="cut"></div>

  <% if @product.has_variations? %>
    <div class="variations">
      <table width="100%">
        <tr>
          <th><%= t(:title) %></th>
          <% if @product.is_variable_price? %>
            <th><%= t(:price) %></th>
          <% end %>
          <% unless @product.is_producible? %>
            <th><%= t(:available) %></th>
          <% end %>
          <th><%= t(:quantity) %></th>
        </tr>
        <% @product.variations.sort_by(&:title).each do |product| %>
          <tr>
            <td><%= h(product.title) %></td>
            <% if product.in_stock? || @product.is_producible? %>
              <% if @product.is_variable_price? %>
                <td><%= product_price(product) %></td>
              <% end %>
              <% unless @product.is_producible? %>
                <td><%= product.quantity %></td>
              <% end %>
              <td>
                <%= f.fields_for :order_lines, OrderLine.new do |ff| %>
                  <%= ff.hidden_field :product_id, :value => product.id %>
                  <%= ff.text_field :quantity, :size => 4, :value => 0 %>
                <% end %>
              </td>
            <% else %>
              <td colspan="3">
                <%= t(:out_of_stock) %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </table>
      <div id="variations-quantity-notice" class="notice" style="display: none;"><%= t(:please_select_quantity) %>.</div>
      <%= submit_tag t(:add_to_cart), :class => "button cart-add", :onclick => 'return verifyVariationsQuantity();' %>
    </div>
  <% end %>

  <div class="description">
    <h3 class="slight-visiable"><%= t(:product_description) %></h3>
    <%= textilize(@product.description) %>
  </div>
  <% end # /form %>
</div>

